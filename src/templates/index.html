<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Leitstelle Simulator</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="status-container">
        <h1>Leitstelle Simulator</h1>

        <div class="card" style="margin-bottom: 30px;">
            <h2 style="margin-bottom: 20px;">Neue Leitstelle erstellen</h2>
            <form id="createForm">
                <div style="margin-bottom: 15px;">
                    <label for="leitstelleName">Name der Leitstelle:</label>
                    <input type="text" id="leitstelleName" name="name" value="Florian Berlin" required>
                </div>
                <button type="submit" style="background: var(--primary-color); width: 100%;">Erstellen</button>
            </form>
        </div>

        <div class="card">
            <h2 style="margin-bottom: 20px;">Einer Leitstelle beitreten</h2>
            
            <form action="/status" method="get">
                <div style="margin-bottom: 15px;">
                    <label for="joinCode">Leitstellen-Code (Fahrzeug- oder Staffelf√ºhrer-Code):</label>
                    <input type="text" id="joinCode" name="code" required>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label for="userName">Name (Funkrufname):</label>
                    <input type="text" id="userName" name="name" required>
                    <div id="error-message" style="display: none; color: var(--danger-color); font-size: 0.8rem; margin-top: 5px; font-weight: bold;">
                        Name bereits vergeben. Ein neuer Name wurde generiert.
                    </div>
                </div>
                
                <button type="submit" style="background: var(--success-color); width: 100%;">Beitreten</button>
            </form>
        </div>
    </div>

    <footer>
        <p>Made with ‚ù§Ô∏è and üè≥Ô∏è‚Äçüåà | <a href="https://github.com/rainbowdashlabs/status-sim" target="_blank">GitHub</a></p>
        <p>&copy; {{ current_year }} Rainbowdashlabs and Contributor GPL-3.0</p>
    </footer>

    <script>
        const createForm = document.getElementById('createForm');
        
        // Random Funkrufname generation
        function generateRandomFunkrufname() {
            let num;
            do {
                num = Math.floor(Math.random() * (65 - 10 + 1)) + 10;
            } while (num % 10 === 0);
            return `LHF ${num}00/1`;
        }
        
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('error') && urlParams.get('error') === 'name_taken') {
            document.getElementById('error-message').style.display = 'block';
            document.getElementById('userName').value = generateRandomFunkrufname();
            if (urlParams.has('code')) {
                document.getElementById('joinCode').value = urlParams.get('code');
            }
        } else {
            document.getElementById('userName').value = generateRandomFunkrufname();
        }

        createForm.onsubmit = async (e) => {
            e.preventDefault();
            const formData = new FormData(createForm);
            const response = await fetch('/leitstelle', {
                method: 'POST',
                body: formData
            });
            const result = await response.json();
            if (result.status === 'success') {
                window.location.href = `/leitstelle/${result.admin_code}`;
            } else {
                alert('Fehler beim Erstellen der Leitstelle');
            }
        };
    </script>
</body>
</html>
